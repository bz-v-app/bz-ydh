<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8"/>
        <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=no" />
        <meta http-equiv="X-UA-Compatible" content="ie=edge"/>
        <title>评价</title>
        <link rel="stylesheet" href="../css/common.css"/>
        <link rel="stylesheet" href="../css/evaluate.css"/>
    </head>
<body>
    <div id="total-eva-box">
        <h2 class="title">整体评价</h2>
        <div class="select-bx">
            <div class="bx">
                <img class="yellow-bx" src="../images/yellow-bx.png" alt="总评价星星"/>
                <img class="black-bx" src="../images/black-bx.png" alt="总评价星星"/>
            </div>
            <div class="bx">
                <img class="yellow-bx" src="../images/yellow-bx.png" alt="总评价星星"/>
                <img class="black-bx" src="../images/black-bx.png" alt="总评价星星"/>
            </div>
            <div class="bx">
                <img class="yellow-bx" src="../images/yellow-bx.png" alt="总评价星星"/>
                <img class="black-bx" src="../images/black-bx.png" alt="总评价星星"/>
            </div>
            <div class="bx">
                <img class="yellow-bx" src="../images/yellow-bx.png" alt="总评价星星"/>
                <img class="black-bx" src="../images/black-bx.png" alt="总评价星星"/>
            </div>
            <div class="bx">
                <img class="yellow-bx" src="../images/yellow-bx.png" alt="总评价星星"/>
                <img class="black-bx" src="../images/black-bx.png" alt="总评价星星"/>
            </div>
        </div>
        <div class="input-eva-box">
            <textarea name="inputEva" id="inputEva" class="inputEva" placeholder="请输入您的评价..." cols="30" rows="10"></textarea>
        </div>
        <div class="special-eva-box">
            <div class="special-one">
                <h3 class="title">服务评价：</h3>
                <div class="sx">
                    <img class="yellow-sx" src="../images/yellow-sx.png" alt="专项评价星星"/>
                    <img class="black-sx" src="../images/black-sx.png" alt="专项评价星星"/>
                </div>
                <div class="sx">
                    <img class="yellow-sx" src="../images/yellow-sx.png" alt="专项评价星星"/>
                    <img class="black-sx" src="../images/black-sx.png" alt="专项评价星星"/>
                </div>
                <div class="sx">
                    <img class="yellow-sx" src="../images/yellow-sx.png" alt="专项评价星星"/>
                    <img class="black-sx" src="../images/black-sx.png" alt="专项评价星星"/>
                </div>
                <div class="sx">
                    <img class="yellow-sx" src="../images/yellow-sx.png" alt="专项评价星星"/>
                    <img class="black-sx" src="../images/black-sx.png" alt="专项评价星星"/>
                </div>
                <div class="sx">
                    <img class="yellow-sx" src="../images/yellow-sx.png" alt="专项评价星星"/>
                    <img class="black-sx" src="../images/black-sx.png" alt="专项评价星星"/>
                </div>  
            </div>
            <div class="special-one">
                <h3 class="title">服务礼仪：</h3>
                <div class="sx">
                    <img class="yellow-sx" src="../images/yellow-sx.png" alt="专项评价星星"/>
                    <img class="black-sx" src="../images/black-sx.png" alt="专项评价星星"/>
                </div>
                <div class="sx">
                    <img class="yellow-sx" src="../images/yellow-sx.png" alt="专项评价星星"/>
                    <img class="black-sx" src="../images/black-sx.png" alt="专项评价星星"/>
                </div>
                <div class="sx">
                    <img class="yellow-sx" src="../images/yellow-sx.png" alt="专项评价星星"/>
                    <img class="black-sx" src="../images/black-sx.png" alt="专项评价星星"/>
                </div>
                <div class="sx">
                    <img class="yellow-sx" src="../images/yellow-sx.png" alt="专项评价星星"/>
                    <img class="black-sx" src="../images/black-sx.png" alt="专项评价星星"/>
                </div>
                <div class="sx">
                    <img class="yellow-sx" src="../images/yellow-sx.png" alt="专项评价星星"/>
                    <img class="black-sx" src="../images/black-sx.png" alt="专项评价星星"/>
                </div>  
            </div>
            <div class="special-one">
                <h3 class="title">员工着装：</h3>
                <div class="sx">
                    <img class="yellow-sx" src="../images/yellow-sx.png" alt="专项评价星星"/>
                    <img class="black-sx" src="../images/black-sx.png" alt="专项评价星星"/>
                </div>
                <div class="sx">
                    <img class="yellow-sx" src="../images/yellow-sx.png" alt="专项评价星星"/>
                    <img class="black-sx" src="../images/black-sx.png" alt="专项评价星星"/>
                </div>
                <div class="sx">
                    <img class="yellow-sx" src="../images/yellow-sx.png" alt="专项评价星星"/>
                    <img class="black-sx" src="../images/black-sx.png" alt="专项评价星星"/>
                </div>
                <div class="sx">
                    <img class="yellow-sx" src="../images/yellow-sx.png" alt="专项评价星星"/>
                    <img class="black-sx" src="../images/black-sx.png" alt="专项评价星星"/>
                </div>
                <div class="sx">
                    <img class="yellow-sx" src="../images/yellow-sx.png" alt="专项评价星星"/>
                    <img class="black-sx" src="../images/black-sx.png" alt="专项评价星星"/>
                </div>  
            </div>
            <div class="special-one">
                <h3 class="title">服务态度：</h3>
                <div class="sx">
                    <img class="yellow-sx" src="../images/yellow-sx.png" alt="专项评价星星"/>
                    <img class="black-sx" src="../images/black-sx.png" alt="专项评价星星"/>
                </div>
                <div class="sx">
                    <img class="yellow-sx" src="../images/yellow-sx.png" alt="专项评价星星"/>
                    <img class="black-sx" src="../images/black-sx.png" alt="专项评价星星"/>
                </div>
                <div class="sx">
                    <img class="yellow-sx" src="../images/yellow-sx.png" alt="专项评价星星"/>
                    <img class="black-sx" src="../images/black-sx.png" alt="专项评价星星"/>
                </div>
                <div class="sx">
                    <img class="yellow-sx" src="../images/yellow-sx.png" alt="专项评价星星"/>
                    <img class="black-sx" src="../images/black-sx.png" alt="专项评价星星"/>
                </div>
                <div class="sx">
                    <img class="yellow-sx" src="../images/yellow-sx.png" alt="专项评价星星"/>
                    <img class="black-sx" src="../images/black-sx.png" alt="专项评价星星"/>
                </div>  
            </div>
        </div>
    </div>
    <div id="submit-btn-box">
        <button class="submit-btn">提交</button>
    </div>
    <script src="../js/lib/jquery-1.8.3.min.js"></script>
    <script>
        let $SpecialOne=$(".special-one");//4个单一评价
        let $totalBx=$(".bx");//总评价
        let totalX=0;//总评价
        let sxObj={
            skill:0,
            ceremony:0,
            clothing:0,
            atitude:0
        };//保存单一评价的星星数,默认为0

        /*
            @Description:
            pi代表四个小评价的索引值，
            ci代表单个小评价中小星星索引
            以下同理
        */
        let getSx=(pi,ci)=>{//计算总星星数，保存单一评价的星星数
            if(ci<0){
                ci=-1;
            }
            let totalSx=0;
            /*ci是索引，要得到星星数要+1*/
            switch (pi){
                case 0:
                    sxObj['skill']=ci+1
                    break;
                case 1:
                    sxObj['ceremony']=ci+1
                    break;
                case 2:
                    sxObj['clothing']=ci+1
                    break;
                case 3:
                    sxObj['atitude']=ci+1
                    break;
                default:
                    break;
            }
            $.each(sxObj,(key,value)=>{
                totalSx+=value;
            });
            totalSx=Math.ceil(totalSx/4);//总数除以4向上取整得到大星星数
            $totalBx.removeClass("yellow").each((i,e)=>{//遍历添加大星星数
                if(i<totalSx){
                    $(e).addClass("yellow");
                }
            });
            return totalSx;
        }
        
        $SpecialOne.each((pi,e)=>{//遍历单一评价的4个对象，为了获得每个单一评价的索引值
            $(e).children(".sx").each((ci,e)=>{//每个单一评价的星星遍历添加点击事件
                $(e).click(function(){
                     /*只要点击的小星星是黄色并且下一个不是黄色或者当前小星星是黄色且为最后一个，则消除一个*/
                    if($(this).next().attr("class")=="sx"&&$(this).attr("class")!="sx"||ci==4&&$(this).attr("class")!="sx"){
                       $(this).removeClass("yellow");
                       totalX=getSx(pi,ci-1);//每次点击，计算总星数和保存当前评价的星星数
                    }else{
                        /*不然就是选到第几个，前面包括点击的这一个就都变黄*/
                        $SpecialOne.eq(pi).children(".sx").removeClass("yellow").each((si,e)=>{//只要索引值没有超过当前点击的星星的索引值就变色
                            if(si<=ci){
                                $(e).addClass("yellow");
                            }
                        })
                       totalX=getSx(pi,ci);
                    }
                })
            }); 
        });
        
        $totalBx.each((i,e)=>{//每个大星星添加点击事件
            $(e).click(function(){
                /*只要点击的大星星是黄色并且下一个不是黄色或者当前大星星是黄色且为最后一个，则消除一个*/
                if($(this).attr("class")!="bx"&&$(this).next().attr("class")=="bx"||i==4&&$(this).attr("class")!="bx"){
                    $(this).removeClass("yellow");
                    bxChange(i,true);
                }else{
                    /*不然就是选到第几个，前面包括点击的这一个就都变黄*/
                    $totalBx.removeClass("yellow").each((ti,e)=>{
                        if(ti<=i){
                            $(e).addClass("yellow");
                        }
                    });
                    bxChange(i,false);
                }
            })
        })

        /*
            @Description：
            i是大星星索引值
            addOrRem ：true/false 
            true为消除一个大星星小星星跟随变化                    
            false为选择第几个大星星小星星也要选择到第几个
        */
        let bxChange=(i,addOrRem)=>{//i代表大星星索引值
            if(addOrRem){//true代表消除一个大星星之后小星星跟随变化
                $SpecialOne.each((pi,e)=>{
                    $(e).children(".sx").removeClass("yellow").each((ci,e)=>{
                        if(ci<i){
                            $(e).addClass("yellow");
                        }
                    })
                    totalX=getSx(pi,i-1);
                })
            }else{
                $SpecialOne.each((pi,e)=>{//false代表选择到第几个大星星,小星星也要选择到第几个
                    $(e).children(".sx").removeClass("yellow").each((ci,e)=>{
                        if(ci<=i){
                            $(e).addClass("yellow");
                        }
                    })
                    totalX=getSx(pi,i);
                });
            }
        }
        
        //按钮添加点击事件
        $("#submit-btn-box").click(function(){
            let str="";
            $.each(sxObj,(key,value)=>{
                str+=`${key}:${value}星\n`; 
            })
            alert(str+`总评价:${totalX}星`);
            
        });
    </script>
</body>
</html>